const element=document.querySelectorAll(".js-choice"),requestURL=(element.forEach(e=>{new Choices(e,{searchEnabled:!1,itemSelectText:"",shouldSort:!1})}),"https://jsonplaceholder.typicode.com/users");function sendRequest(o,r,s=null){return new Promise((e,t)=>{const n=new XMLHttpRequest;n.open(o,r),n.responseType="json",n.setRequestHeader("ContentType","application/json"),n.onload=()=>{(400<=n.status?t:e)(n.response)},n.onerror=()=>{t(n.response)},n.send(JSON.stringify(s))})}const form=document.getElementById("form"),completeBtn=document.querySelector(".complete__btn");function users(){var e=document.getElementById("first_name"),t=document.getElementById("last_name"),n=document.getElementById("mail"),o=document.getElementById("password"),r=document.getElementById("nationality"),s=document.querySelectorAll(".-gender"),a=document.getElementById("day").value,l=document.getElementById("month").value,c=document.getElementById("year").value,s=(s.forEach(e=>{e.checked&&(genderValue=e.value)}),{firstName:e.value,lastName:t.value,nationality:r.value,email:n.value,birthday:new Date(c,l,a),gender:genderValue,password:o.value});return s}function btnAnimation(){completeBtn.classList.add("btn-animation"),completeBtn.addEventListener("animationend",function(){completeBtn.classList.remove("btn-animation")},!1)}function validatorForm(e){let o=!0;var t=document.querySelectorAll("._req");let r=document.getElementById("password"),s=document.getElementById("confirm_password");function a(e,t){var e=e.parentNode,n=document.createElement("span");n.classList.add("error-text"),n.textContent=t,e.querySelector("._req").classList.add("_error"),e.append(n)}return t.forEach(e=>{var t,n;n=(t=e).parentNode,t.classList.contains("_error")&&(n.querySelector(".error-text").remove(),t.classList.remove("_error")),e.classList.contains("_email")?emailTest(e)&&(a(e,"E-mail не по шаблону!"),o=!1):e.classList.contains("_password")?passwordTest(e)?(a(e,"От 8 символов, заглавные и строчные буквы, цифры"),o=!1):r.value!==s.value&&(a(e,"Пароль не совпадает!"),o=!1):""===e.value&&(a(e,"Поле не заполнено!"),o=!1)}),o}function emailTest(e){return!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(e.value)}function passwordTest(e){return!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/.test(e.value)}form.addEventListener("submit",e=>{e.preventDefault();const t=document.querySelector(".form__success"),n=document.querySelector(".form__registered");1==validatorForm(this)?sendRequest("POST",requestURL,users()).then(()=>{e.target.reset(),t.style.display="block",n.style.display="none"}).catch(e=>console.log(e)):btnAnimation()});